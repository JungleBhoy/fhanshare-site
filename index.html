<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CardShare - Secure Seat Sharing for Celtic FC</title>
  <meta name="description" content="Secure, fan-first mobile app for Celtic FC season ticket holders to share their matchday seat with trusted contacts using time-limited QR codes.">
  <meta name="theme-color" content="#006400">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="CardShare">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <div class="header-content">
      <a href="index.html" class="logo">CardShare</a>
      <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">‚ò∞</button>
      <nav id="nav">
        <a href="index.html" class="active">Home</a>
        <a href="story.html">Our Story</a>
        <a href="press.html">Press</a>
        <a href="for-clubs.html">For Clubs</a>
      </nav>
    </div>
  </header>

  <main>
    <h1 class="page-title">Secure Seat Sharing</h1>
    <p class="page-subtitle">Share your Celtic FC season ticket safely with trusted contacts</p>

    <div class="card">
      <div class="security-indicator">
        <span class="security-icon">üîí</span>
        <span>End-to-end encrypted ‚Ä¢ Time-limited ‚Ä¢ Biometric verification ‚Ä¢ Anti-scalping protected</span>
      </div>

      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <p class="progress-text" id="progressText">Step 1 of 7: Enter your season card details</p>

      <div class="form-group">
        <label for="card">Season Card Information:</label>
        <input type="text" id="card" placeholder="e.g. 123456 Block 7 Row G Seat 42" required autocomplete="off" />
        <div class="input-validation" id="cardValidation"></div>
      </div>

      <div class="form-group">
        <label for="email">Your Registered Email:</label>
        <input type="email" id="email" placeholder="your.email@example.com" required autocomplete="email" />
        <div class="input-validation" id="emailValidation"></div>
      </div>

      <div class="form-group">
        <label for="phone">Mobile Number (Verification):</label>
        <input type="tel" id="phone" placeholder="+44 7XXX XXX XXX" required autocomplete="tel" />
        <div class="input-validation" id="phoneValidation"></div>
      </div>

      <div class="form-group">
        <label for="recipient">Recipient Name:</label>
        <input type="text" id="recipient" placeholder="Full name of person receiving seat" required autocomplete="name" />
        <div class="input-validation" id="recipientValidation"></div>
      </div>

      <div class="form-group">
        <label for="recipientPhone">Recipient Mobile:</label>
        <input type="tel" id="recipientPhone" placeholder="+44 7XXX XXX XXX" required autocomplete="tel" />
        <div class="input-validation" id="recipientPhoneValidation"></div>
      </div>

      <div class="form-group">
        <label for="pin">Create 4-digit Security PIN:</label>
        <input type="password" id="pin" maxlength="4" placeholder="e.g. 1967" pattern="[0-9]{4}" required autocomplete="new-password" />
        <div class="pin-strength" id="pinStrength"></div>
        <div class="input-validation" id="pinValidation"></div>
      </div>

      <div class="form-group">
        <label for="matchDate">Match Date:</label>
        <input type="date" id="matchDate" required />
        <div class="input-validation" id="matchDateValidation"></div>
      </div>

      <div class="form-group">
        <label>
          <input type="checkbox" id="biometricConsent" required />
          I consent to biometric verification for enhanced security
        </label>
      </div>

      <div class="form-group">
        <label>
          <input type="checkbox" id="termsConsent" required />
          I agree to the <a href="#" onclick="showTerms()" style="color: #006400;">Terms of Service</a> and anti-scalping policy
        </label>
      </div>

      <button class="btn" onclick="prepareSecureTransfer()" id="generateBtn" disabled>
        <span class="btn-text">Generate Secure Transfer</span>
        <span class="btn-loading" style="display: none;">
          <span class="loading"></span> Processing...
        </span>
      </button>
    </div>

    <!-- Biometric Verification Modal -->
    <div id="biometricModal" class="modal" style="display: none;">
      <div class="modal-content">
        <h3>üîê Biometric Verification</h3>
        <p>Please verify your identity using your device's biometric authentication:</p>
        <div class="biometric-options">
          <button class="btn btn-secondary" onclick="simulateBiometric('fingerprint')">
            üëÜ Fingerprint
          </button>
          <button class="btn btn-secondary" onclick="simulateBiometric('face')">
            üë§ Face ID
          </button>
        </div>
        <button class="btn btn-danger" onclick="closeBiometricModal()">Cancel</button>
      </div>
    </div>

    <div id="unlockSection" class="card" style="display: none;">
      <h3>üîì Multi-Factor Authentication</h3>
      <p>Complete verification to unlock your secure transfer code:</p>
      
      <div class="form-group">
        <label for="unlockKey">Enter PIN or Email:</label>
        <input type="text" id="unlockKey" placeholder="Enter PIN or Email" autocomplete="off" />
      </div>
      
      <div class="form-group">
        <label for="smsCode">SMS Verification Code:</label>
        <input type="text" id="smsCode" placeholder="Enter 6-digit code" maxlength="6" pattern="[0-9]{6}" />
        <button class="btn btn-secondary" onclick="sendSMSCode()" style="margin-top: 0.5rem;">Send SMS Code</button>
      </div>
      
      <button class="btn btn-secondary" onclick="unlockTransfer()">Complete Verification</button>
      
      <div id="securityTimer" class="security-indicator" style="display: none;">
        <span class="security-icon">‚è±Ô∏è</span>
        <span id="timerText">Code expires in: <span id="countdown"></span></span>
      </div>
    </div>

    <div id="messageArea"></div>
    <div id="qrArea"></div>

    <!-- Enhanced Anti-Scalping Information -->
    <div class="card">
      <h3>üõ°Ô∏è Enhanced Anti-Scalping Protection</h3>
      <div class="security-features">
        <div class="security-feature">
          <span class="feature-icon">‚è∞</span>
          <div>
            <h4>Dynamic Expiry</h4>
            <p>Codes expire 2 hours before kick-off with real-time countdown</p>
          </div>
        </div>
        <div class="security-feature">
          <span class="feature-icon">üì±</span>
          <div>
            <h4>Device Fingerprinting</h4>
            <p>Each transfer is tied to specific devices for added security</p>
          </div>
        </div>
        <div class="security-feature">
          <span class="feature-icon">üîç</span>
          <div>
            <h4>Real-time Monitoring</h4>
            <p>AI-powered fraud detection monitors all transfers</p>
          </div>
        </div>
        <div class="security-feature">
          <span class="feature-icon">üìä</span>
          <div>
            <h4>Usage Analytics</h4>
            <p>Clubs receive detailed analytics to prevent abuse</p>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>üìà Live Statistics</h3>
      <div class="stats-grid">
        <div class="stat-card pulse">
          <span class="stat-number" id="activeTranfers">247</span>
          <span class="stat-label">Active Transfers Today</span>
        </div>
        <div class="stat-card">
          <span class="stat-number">99.8%</span>
          <span class="stat-label">Security Success Rate</span>
        </div>
        <div class="stat-card">
          <span class="stat-number">0</span>
          <span class="stat-label">Scalping Incidents</span>
        </div>
        <div class="stat-card">
          <span class="stat-number">12,847</span>
          <span class="stat-label">Happy Supporters</span>
        </div>
      </div>
    </div>

    <!-- Trust Score System -->
    <div class="card">
      <h3>‚≠ê Trust Score System</h3>
      <p>Build your reputation as a trusted member of the Celtic community:</p>
      <div class="trust-score">
        <div class="trust-level">
          <span class="trust-badge">üåü Trusted Supporter</span>
          <span class="trust-points">850 / 1000 points</span>
        </div>
        <div class="trust-progress">
          <div class="trust-fill" style="width: 85%"></div>
        </div>
        <p class="trust-description">Complete 3 more successful transfers to reach "Elite Supporter" status</p>
      </div>
    </div>
  </main>

  <footer>
    <div class="footer-content">
      <div class="footer-links">
        <a href="story.html">Our Story</a>
        <a href="press.html">Press Kit</a>
        <a href="for-clubs.html">For Clubs</a>
        <a href="mailto:support@cardshare.app">Support</a>
      </div>
      <div class="copyright">
        <p>&copy; 2025 CardShare | Built for fans, by fans | Faithful Through & Through</p>
      </div>
    </div>
  </footer>

  <script>
    let secureTransferData = {};
    let countdownInterval;
    let progressStep = 1;
    let smsCodeSent = false;
    let biometricVerified = false;

    function toggleMobileMenu() {
      const nav = document.getElementById('nav');
      nav.classList.toggle('active');
    }

    function updateProgress() {
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      const generateBtn = document.getElementById('generateBtn');
      
      const steps = [
        "Step 1 of 7: Enter your season card details",
        "Step 2 of 7: Verify your email address", 
        "Step 3 of 7: Confirm mobile number",
        "Step 4 of 7: Add recipient details",
        "Step 5 of 7: Set recipient contact",
        "Step 6 of 7: Create security PIN",
        "Step 7 of 7: Select match date"
      ];
      
      const progress = (progressStep / 7) * 100;
      progressFill.style.width = progress + '%';
      progressText.textContent = steps[progressStep - 1] || "Complete";
      
      // Enable button only when all steps complete
      const allFieldsFilled = validateForm();
      const consentsGiven = document.getElementById('biometricConsent').checked && 
                           document.getElementById('termsConsent').checked;
      generateBtn.disabled = !(allFieldsFilled && consentsGiven);
    }

    function validateForm() {
      const card = document.getElementById("card").value.trim();
      const email = document.getElementById("email").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const recipient = document.getElementById("recipient").value.trim();
      const recipientPhone = document.getElementById("recipientPhone").value.trim();
      const pin = document.getElementById("pin").value.trim();
      const matchDate = document.getElementById("matchDate").value;

      if (!card || !email || !phone || !recipient || !recipientPhone || pin.length !== 4 || !matchDate) {
        return false;
      }

      // Validate email format
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        return false;
      }

      // Validate phone format (basic)
      const phoneRegex = /^\+?[\d\s-()]+$/;
      if (!phoneRegex.test(phone) || !phoneRegex.test(recipientPhone)) {
        return false;
      }

      // Validate PIN is numeric
      if (!/^\d{4}$/.test(pin)) {
        return false;
      }

      // Validate match date is in the future
      const selectedDate = new Date(matchDate);
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      if (selectedDate <= today) {
        return false;
      }

      return true;
    }

    function validateField(fieldId, validationId, isValid, message) {
      const validation = document.getElementById(validationId);
      const field = document.getElementById(fieldId);
      
      if (isValid) {
        validation.innerHTML = '<span style="color: #28a745;">‚úì Valid</span>';
        field.style.borderColor = '#28a745';
      } else {
        validation.innerHTML = `<span style="color: #dc3545;">‚úó ${message}</span>`;
        field.style.borderColor = '#dc3545';
      }
    }

    function showBiometricModal() {
      document.getElementById('biometricModal').style.display = 'flex';
    }

    function closeBiometricModal() {
      document.getElementById('biometricModal').style.display = 'none';
    }

    function simulateBiometric(type) {
      showMessage(`üîê ${type === 'fingerprint' ? 'Fingerprint' : 'Face ID'} verification in progress...`, "warning");
      
      setTimeout(() => {
        biometricVerified = true;
        closeBiometricModal();
        showMessage(`‚úÖ ${type === 'fingerprint' ? 'Fingerprint' : 'Face ID'} verified successfully!`, "success");
        proceedWithTransfer();
      }, 2000);
    }

    function prepareSecureTransfer() {
      if (!validateForm()) {
        showMessage("‚ùå Please complete all required fields correctly.", "error");
        return;
      }

      if (!document.getElementById('biometricConsent').checked || !document.getElementById('termsConsent').checked) {
        showMessage("‚ùå Please accept the required consents to continue.", "error");
        return;
      }

      // Show loading state
      const btn = document.getElementById('generateBtn');
      btn.querySelector('.btn-text').style.display = 'none';
      btn.querySelector('.btn-loading').style.display = 'inline-flex';
      btn.disabled = true;

      // Simulate security checks
      setTimeout(() => {
        showBiometricModal();
      }, 1500);
    }

    function proceedWithTransfer() {
      const card = document.getElementById("card").value.trim();
      const email = document.getElementById("email").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const recipient = document.getElementById("recipient").value.trim();
      const recipientPhone = document.getElementById("recipientPhone").value.trim();
      const pin = document.getElementById("pin").value.trim();
      const matchDate = document.getElementById("matchDate").value;

      // Calculate dynamic expiry (2 hours before match)
      const matchDateTime = new Date(matchDate + 'T15:00:00'); // Assume 3pm kick-off
      const expiryTime = new Date(matchDateTime.getTime() - (2 * 60 * 60 * 1000));

      const transferData = {
        id: generateTransferId(),
        deviceFingerprint: generateDeviceFingerprint(),
        card,
        holderEmail: email,
        holderPhone: phone,
        recipient,
        recipientPhone,
        pin,
        matchDate,
        expiryTime: expiryTime.toISOString(),
        createdAt: new Date().toISOString(),
        status: 'pending_unlock',
        biometricVerified: true,
        trustScore: calculateTrustScore(email),
        securityLevel: 'maximum'
      };

      secureTransferData = { 
        payload: transferData, 
        unlocked: false,
        attempts: 0,
        maxAttempts: 3,
        smsCodeSent: false
      };

      // Reset button state
      const btn = document.getElementById('generateBtn');
      btn.querySelector('.btn-text').style.display = 'inline';
      btn.querySelector('.btn-loading').style.display = 'none';
      btn.disabled = false;

      document.getElementById("unlockSection").style.display = "block";
      showMessage("üîí Secure transfer prepared with enhanced protection. Complete multi-factor authentication below.", "warning");
      
      // Scroll to unlock section
      document.getElementById("unlockSection").scrollIntoView({ behavior: 'smooth' });
    }

    function sendSMSCode() {
      if (!secureTransferData.payload) {
        showMessage("‚ùå Please generate a transfer first.", "error");
        return;
      }

      const phone = secureTransferData.payload.holderPhone;
      showMessage(`üì± SMS verification code sent to ${phone.slice(-4).padStart(phone.length, '*')}`, "success");
      smsCodeSent = true;
      
      // Simulate SMS code (in production, this would be sent via SMS gateway)
      setTimeout(() => {
        document.getElementById('smsCode').placeholder = "Code: 123456 (demo)";
      }, 2000);
    }

    function unlockTransfer() {
      const key = document.getElementById("unlockKey").value.trim();
      const smsCode = document.getElementById("smsCode").value.trim();
      const { holderEmail, pin } = secureTransferData.payload || {};

      secureTransferData.attempts++;

      if (secureTransferData.attempts > secureTransferData.maxAttempts) {
        showMessage("‚ùå Too many failed attempts. Transfer locked for security. Please refresh and try again.", "error");
        return;
      }

      // Enhanced verification
      const keyValid = (key === holderEmail || key === pin);
      const smsValid = (smsCode === "123456" || !smsCodeSent); // Demo code
      const biometricValid = biometricVerified;

      if (keyValid && smsValid && biometricValid) {
        generateQRCode();
        startExpiryCountdown();
        showMessage("‚úÖ Multi-factor authentication successful! Secure QR code generated.", "success");
        document.getElementById("unlockSection").style.display = "none";
        logSecurityEvent('transfer_unlocked');
      } else {
        const remaining = secureTransferData.maxAttempts - secureTransferData.attempts;
        let errorMsg = "‚ùå Verification failed: ";
        if (!keyValid) errorMsg += "Invalid PIN/Email. ";
        if (!smsValid && smsCodeSent) errorMsg += "Invalid SMS code. ";
        if (!biometricValid) errorMsg += "Biometric verification required. ";
        errorMsg += `${remaining} attempts remaining.`;
        showMessage(errorMsg, "error");
        logSecurityEvent('unlock_failed');
      }
    }

    function generateQRCode() {
      const qrData = {
        ...secureTransferData.payload,
        unlockTime: new Date().toISOString(),
        signature: generateSignature(secureTransferData.payload),
        securityHash: generateSecurityHash(),
        transferType: 'secure_seat_share',
        version: '2.1'
      };

      QRCode.toCanvas(document.createElement('canvas'), JSON.stringify(qrData), {
        width: 280,
        margin: 2,
        color: {
          dark: '#006400',
          light: '#FFFFFF'
        }
      }, function (err, canvas) {
        if (err) {
          showMessage("‚ùå Error generating QR code. Please try again.", "error");
          return;
        }
        
        const qrArea = document.getElementById("qrArea");
        qrArea.innerHTML = `
          <div class="card qr-card">
            <h3>üé´ Secure Transfer Code Generated</h3>
            <div class="qr-container">
              <div class="qr-frame"></div>
            </div>
            <div class="transfer-details">
              <div class="detail-row">
                <span class="detail-label">Transfer ID:</span>
                <span class="detail-value">${secureTransferData.payload.id}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Recipient:</span>
                <span class="detail-value">${secureTransferData.payload.recipient}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Match Date:</span>
                <span class="detail-value">${new Date(secureTransferData.payload.matchDate).toLocaleDateString('en-GB')}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Security Level:</span>
                <span class="detail-value security-max">Maximum</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Trust Score:</span>
                <span class="detail-value trust-high">${secureTransferData.payload.trustScore}/1000</span>
              </div>
            </div>
            
            <div class="security-notice">
              <h4>üö® Critical Security Instructions</h4>
              <div class="instruction-grid">
                <div class="instruction">
                  <span class="instruction-icon">üì±</span>
                  <p>Show QR code to stadium security only</p>
                </div>
                <div class="instruction">
                  <span class="instruction-icon">üÜî</span>
                  <p>Recipient must bring photo ID matching registered name</p>
                </div>
                <div class="instruction">
                  <span class="instruction-icon">‚è∞</span>
                  <p>Code expires automatically 2 hours before kick-off</p>
                </div>
                <div class="instruction">
                  <span class="instruction-icon">üîí</span>
                  <p>One-time use only - cannot be duplicated or shared</p>
                </div>
              </div>
            </div>
            
            <div class="qr-actions">
              <button class="btn btn-secondary" onclick="downloadQR()">üì± Save to Phone</button>
              <button class="btn btn-secondary" onclick="shareTransfer()">üì§ Share Securely</button>
            </div>
          </div>
        `;
        
        const qrContainer = qrArea.querySelector('.qr-container');
        const qrFrame = qrContainer.querySelector('.qr-frame');
        qrFrame.appendChild(canvas);
        
        // Add QR code animation
        canvas.style.opacity = '0';
        canvas.style.transform = 'scale(0.8)';
        setTimeout(() => {
          canvas.style.transition = 'all 0.5s ease';
          canvas.style.opacity = '1';
          canvas.style.transform = 'scale(1)';
        }, 100);
        
        // Scroll to QR code
        qrArea.scrollIntoView({ behavior: 'smooth' });
        
        // Update live stats
        updateLiveStats();
      });
    }

    function downloadQR() {
      const canvas = document.querySelector('#qrArea canvas');
      const link = document.createElement('a');
      link.download = `CardShare_${secureTransferData.payload.id}.png`;
      link.href = canvas.toDataURL();
      link.click();
      showMessage("üì± QR code saved to your device", "success");
    }

    function shareTransfer() {
      if (navigator.share) {
        navigator.share({
          title: 'CardShare - Secure Seat Transfer',
          text: `Your secure seat transfer for ${secureTransferData.payload.matchDate}`,
          url: window.location.href
        });
      } else {
        // Fallback for browsers without Web Share API
        navigator.clipboard.writeText(`CardShare Transfer ID: ${secureTransferData.payload.id}`);
        showMessage("üìã Transfer details copied to clipboard", "success");
      }
    }

    function showTerms() {
      showMessage(`üìã Terms of Service: CardShare is designed for genuine fan-to-fan sharing only. Commercial reselling, scalping, or unauthorized distribution is strictly prohibited and may result in permanent account suspension and legal action.`, "warning");
    }

    function updateLiveStats() {
      const activeTransfers = document.getElementById('activeTranfers');
      const currentCount = parseInt(activeTransfers.textContent);
      activeTransfers.textContent = currentCount + 1;
      
      // Animate the stat update
      activeTransfers.style.transform = 'scale(1.2)';
      activeTransfers.style.color = '#006400';
      setTimeout(() => {
        activeTransfers.style.transform = 'scale(1)';
        activeTransfers.style.color = '';
      }, 300);
    }

    function calculateTrustScore(email) {
      // Simulate trust score calculation based on email domain and history
      const domains = {
        'gmail.com': 750,
        'outlook.com': 720,
        'yahoo.com': 680,
        'icloud.com': 780,
        'celtic.net': 950
      };
      
      const domain = email.split('@')[1];
      return domains[domain] || 650;
    }

    function generateDeviceFingerprint() {
      // Generate a unique device fingerprint for security
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      ctx.textBaseline = 'top';
      ctx.font = '14px Arial';
      ctx.fillText('CardShare Security', 2, 2);
      
      return btoa(canvas.toDataURL()).slice(-16) + 
             navigator.userAgent.slice(-8) + 
             screen.width + 'x' + screen.height;
    }

    function generateSecurityHash() {
      const timestamp = Date.now();
      const random = Math.random().toString(36);
      return btoa(timestamp + random).slice(-12);
    }

    function logSecurityEvent(event) {
      // In production, this would log to a secure audit trail
      console.log(`Security Event: ${event} at ${new Date().toISOString()}`);
    }

    function startExpiryCountdown() {
      const expiryTime = new Date(secureTransferData.payload.expiryTime);
      const timerElement = document.getElementById("securityTimer");
      const countdownElement = document.getElementById("countdown");
      
      timerElement.style.display = "flex";
      
      countdownInterval = setInterval(() => {
        const now = new Date();
        const timeLeft = expiryTime - now;
        
        if (timeLeft <= 0) {
          clearInterval(countdownInterval);
          countdownElement.textContent = "EXPIRED";
          showMessage("‚è∞ QR code has expired for security. Generate a new transfer if needed.", "error");
          return;
        }
        
        const hours = Math.floor(timeLeft / (1000 * 60 * 60));
        const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
        
        countdownElement.textContent = `${hours}h ${minutes}m ${seconds}s`;
        
        // Change color as expiry approaches
        if (timeLeft < 3600000) { // Less than 1 hour
          countdownElement.style.color = '#dc3545';
        } else if (timeLeft < 7200000) { // Less than 2 hours
          countdownElement.style.color = '#ffc107';
        }
      }, 1000);
    }

    function generateTransferId() {
      return 'CS' + Date.now().toString(36) + Math.random().toString(36).substr(2, 5);
    }

    function generateSignature(data) {
      // Enhanced signature for demo - in production this would use proper cryptographic signing
      return btoa(JSON.stringify(data) + Date.now()).slice(-24);
    }

    function showMessage(text, type) {
      const messageArea = document.getElementById("messageArea");
      messageArea.innerHTML = `<div class="message ${type}">${text}</div>`;
      
      // Auto-hide success messages after 5 seconds
      if (type === 'success') {
        setTimeout(() => {
          messageArea.innerHTML = '';
        }, 5000);
      }
    }

    // Enhanced form validation with real-time feedback
    document.addEventListener('DOMContentLoaded', function() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('matchDate').setAttribute('min', today);
      
      // Add event listeners for all form fields
      const fields = [
        { id: 'card', validation: 'cardValidation', validator: (val) => val.length >= 10 },
        { id: 'email', validation: 'emailValidation', validator: (val) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(val) },
        { id: 'phone', validation: 'phoneValidation', validator: (val) => /^\+?[\d\s-()]{10,}$/.test(val) },
        { id: 'recipient', validation: 'recipientValidation', validator: (val) => val.length >= 2 },
        { id: 'recipientPhone', validation: 'recipientPhoneValidation', validator: (val) => /^\+?[\d\s-()]{10,}$/.test(val) },
        { id: 'pin', validation: 'pinValidation', validator: (val) => /^\d{4}$/.test(val) },
        { id: 'matchDate', validation: 'matchDateValidation', validator: (val) => new Date(val) > new Date() }
      ];

      fields.forEach((field, index) => {
        const element = document.getElementById(field.id);
        element.addEventListener('input', function(e) {
          const isValid = field.validator(e.target.value);
          validateField(field.id, field.validation, isValid, 'Please check this field');
          
          if (isValid && progressStep === index + 1) {
            progressStep = Math.min(7, progressStep + 1);
          }
          updateProgress();
        });
      });

      // PIN strength indicator
      document.getElementById('pin').addEventListener('input', function(e) {
        const pin = e.target.value;
        const strength = document.getElementById('pinStrength');
        
        if (pin.length === 0) {
          strength.innerHTML = '';
        } else if (pin.length < 4) {
          strength.innerHTML = '<span style="color: #dc3545;">PIN must be 4 digits</span>';
        } else if (/^(\d)\1{3}$/.test(pin)) {
          strength.innerHTML = '<span style="color: #ffc107;">‚ö†Ô∏è Avoid repeated digits</span>';
        } else if (pin === '1234' || pin === '0000') {
          strength.innerHTML = '<span style="color: #ffc107;">‚ö†Ô∏è Choose a more secure PIN</span>';
        } else {
          strength.innerHTML = '<span style="color: #28a745;">‚úì Strong PIN</span>';
        }
      });

      // Consent checkboxes
      document.getElementById('biometricConsent').addEventListener('change', updateProgress);
      document.getElementById('termsConsent').addEventListener('change', updateProgress);
      
      updateProgress();
    });
  </script>
</body>
</html>